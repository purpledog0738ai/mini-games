<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Reaction Time - Mini Games</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', sans-serif;
            overflow: hidden;
            transition: background-color 0.3s;
        }
        
        /* ìƒíƒœë³„ ë°°ê²½ìƒ‰ */
        body.waiting {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        body.ready {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        body.result {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        body.early {
            background: linear-gradient(135deg, #f39c12, #d68910);
        }
        body.menu {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
        }

        .game-container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            cursor: pointer;
        }

        .icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .icon.ready {
            animation: none;
        }

        .message {
            color: white;
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .sub-message {
            color: rgba(255,255,255,0.8);
            font-size: 1.1rem;
            text-align: center;
        }

        .time-display {
            font-size: 5rem;
            font-weight: bold;
            color: white;
            margin: 20px 0;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .time-display span {
            font-size: 2rem;
            vertical-align: baseline;
        }

        /* ë©”ë‰´ í™”ë©´ */
        .menu-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
        }
        .menu-screen h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(255, 200, 50, 0.5);
        }
        .menu-screen .desc {
            color: rgba(255,255,255,0.7);
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        /* í†µê³„ */
        .stats {
            display: flex;
            gap: 20px;
            margin: 30px 0;
        }
        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 15px 25px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(5px);
        }
        .stat-item .label {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.6);
            margin-bottom: 5px;
        }
        .stat-item .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #f1c40f;
        }

        /* íˆìŠ¤í† ë¦¬ */
        .history {
            display: flex;
            gap: 8px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 300px;
        }
        .history-item {
            width: 45px;
            height: 45px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            color: white;
        }
        .history-item.fast { background: #2ecc71; }
        .history-item.medium { background: #f1c40f; }
        .history-item.slow { background: #e74c3c; }
        .history-item.early { background: #95a5a6; }

        /* ë²„íŠ¼ */
        .btn {
            background: linear-gradient(145deg, #00d4ff, #00a8cc);
            color: white;
            border: none;
            padding: 18px 50px;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 20px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.4);
        }
        .btn:active {
            transform: scale(0.98);
        }

        /* ë“±ê¸‰ í‘œì‹œ */
        .grade {
            font-size: 1.2rem;
            padding: 8px 20px;
            border-radius: 20px;
            margin-top: 10px;
            font-weight: bold;
        }
        .grade.excellent { background: linear-gradient(135deg, #f1c40f, #f39c12); color: #fff; }
        .grade.great { background: linear-gradient(135deg, #2ecc71, #27ae60); color: #fff; }
        .grade.good { background: linear-gradient(135deg, #3498db, #2980b9); color: #fff; }
        .grade.average { background: linear-gradient(135deg, #9b59b6, #8e44ad); color: #fff; }
        .grade.slow { background: linear-gradient(135deg, #e74c3c, #c0392b); color: #fff; }

        /* íŒ */
        .tip {
            position: fixed;
            bottom: 30px;
            color: rgba(255,255,255,0.5);
            font-size: 0.85rem;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 400px) {
            .message { font-size: 1.6rem; }
            .time-display { font-size: 4rem; }
            .icon { font-size: 60px; }
        }
    </style>
</head>
<body class="menu">
    <div class="game-container" id="gameContainer">
        <!-- ë©”ë‰´ í™”ë©´ -->
        <div class="menu-screen" id="menuScreen">
            <div class="icon">âš¡</div>
            <h1>Reaction Time</h1>
            <p class="desc">ë¹¨ê°„ìƒ‰ì´ ì´ˆë¡ìƒ‰ìœ¼ë¡œ ë°”ë€Œë©´ í„°ì¹˜!</p>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="label">ìµœê³  ê¸°ë¡</div>
                    <div class="value" id="bestTime">-</div>
                </div>
                <div class="stat-item">
                    <div class="label">í‰ê· </div>
                    <div class="value" id="avgTime">-</div>
                </div>
            </div>
            
            <button class="btn" id="startBtn">ğŸ® ì‹œì‘í•˜ê¸°</button>
            
            <div class="history" id="history"></div>
        </div>
        
        <!-- ê²Œì„ í™”ë©´ -->
        <div id="gameScreen" style="display: none; text-align: center;">
            <div class="icon" id="gameIcon">ğŸ¯</div>
            <div class="message" id="gameMessage">ì¤€ë¹„...</div>
            <div class="sub-message" id="gameSubMessage">ì´ˆë¡ìƒ‰ì´ ë˜ë©´ í„°ì¹˜í•˜ì„¸ìš”</div>
            <div class="time-display" id="timeDisplay" style="display: none;">0<span>ms</span></div>
            <div class="grade" id="gradeDisplay" style="display: none;"></div>
        </div>
    </div>
    
    <p class="tip" id="tip">í™”ë©´ ì•„ë¬´ ê³³ì´ë‚˜ í„°ì¹˜í•˜ì„¸ìš”</p>

    <!-- ì‚¬ìš´ë“œ -->
    <script>
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx = null;

        function playBeep(freq = 800, duration = 100, type = 'sine') {
            if (!audioCtx) audioCtx = new AudioContext();
            
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            oscillator.type = type;
            oscillator.frequency.value = freq;
            
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration / 1000);
            
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + duration / 1000);
        }

        function playSuccess() {
            playBeep(880, 100);
            setTimeout(() => playBeep(1100, 150), 100);
        }

        function playFail() {
            playBeep(200, 300, 'sawtooth');
        }
    </script>

    <script>
        const gameContainer = document.getElementById('gameContainer');
        const menuScreen = document.getElementById('menuScreen');
        const gameScreen = document.getElementById('gameScreen');
        const startBtn = document.getElementById('startBtn');
        const gameIcon = document.getElementById('gameIcon');
        const gameMessage = document.getElementById('gameMessage');
        const gameSubMessage = document.getElementById('gameSubMessage');
        const timeDisplay = document.getElementById('timeDisplay');
        const gradeDisplay = document.getElementById('gradeDisplay');
        const bestTimeEl = document.getElementById('bestTime');
        const avgTimeEl = document.getElementById('avgTime');
        const historyEl = document.getElementById('history');
        const tip = document.getElementById('tip');

        let state = 'menu'; // menu, waiting, ready, result, early
        let startTime = 0;
        let timeoutId = null;
        let history = JSON.parse(localStorage.getItem('reactionHistory')) || [];
        let bestTime = parseInt(localStorage.getItem('reactionBest')) || 0;
        let round = 0;
        const MAX_ROUNDS = 5;

        // ì´ˆê¸°í™”
        updateStats();

        // ì‹œì‘ ë²„íŠ¼
        startBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            startGame();
        });

        // ê²Œì„ ì˜ì—­ í„°ì¹˜/í´ë¦­
        gameContainer.addEventListener('click', handleGameClick);
        gameContainer.addEventListener('touchstart', (e) => {
            e.preventDefault();
            handleGameClick();
        }, { passive: false });

        function startGame() {
            round = 0;
            history = [];
            menuScreen.style.display = 'none';
            gameScreen.style.display = 'block';
            tip.style.display = 'block';
            nextRound();
        }

        function nextRound() {
            round++;
            state = 'waiting';
            document.body.className = 'waiting';
            
            gameIcon.textContent = 'ğŸ¯';
            gameIcon.classList.remove('ready');
            gameMessage.textContent = `ë¼ìš´ë“œ ${round}/${MAX_ROUNDS}`;
            gameSubMessage.textContent = 'ì´ˆë¡ìƒ‰ì´ ë˜ë©´ í„°ì¹˜!';
            timeDisplay.style.display = 'none';
            gradeDisplay.style.display = 'none';
            tip.textContent = 'ê¸°ë‹¤ë¦¬ì„¸ìš”...';

            // ëœë¤ ë”œë ˆì´ (1.5 ~ 5ì´ˆ)
            const delay = 1500 + Math.random() * 3500;
            timeoutId = setTimeout(() => {
                if (state === 'waiting') {
                    showGreen();
                }
            }, delay);
        }

        function showGreen() {
            state = 'ready';
            document.body.className = 'ready';
            
            gameIcon.textContent = 'âš¡';
            gameIcon.classList.add('ready');
            gameMessage.textContent = 'ì§€ê¸ˆ!';
            gameSubMessage.textContent = 'ë¹¨ë¦¬ í„°ì¹˜í•˜ì„¸ìš”!';
            tip.textContent = 'í„°ì¹˜!';

            startTime = performance.now();
            playBeep(1000, 50);
        }

        function handleGameClick() {
            if (state === 'menu') return;

            if (state === 'waiting') {
                // ë„ˆë¬´ ë¹¨ë¦¬ í´ë¦­ (ì„±ê¸‰í•¨)
                clearTimeout(timeoutId);
                showEarly();
            } else if (state === 'ready') {
                // ì •ìƒ í´ë¦­
                const reactionTime = Math.round(performance.now() - startTime);
                showResult(reactionTime);
            } else if (state === 'result' || state === 'early') {
                // ê²°ê³¼ í™”ë©´ì—ì„œ í´ë¦­ - ë‹¤ìŒ ë¼ìš´ë“œ ë˜ëŠ” ë©”ë‰´
                if (round >= MAX_ROUNDS) {
                    showMenu();
                } else {
                    nextRound();
                }
            }
        }

        function showEarly() {
            state = 'early';
            document.body.className = 'early';
            
            gameIcon.textContent = 'ğŸ˜…';
            gameMessage.textContent = 'ë„ˆë¬´ ë¹¨ë¼ìš”!';
            gameSubMessage.textContent = 'ì´ˆë¡ìƒ‰ì´ ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ì„¸ìš”';
            tip.textContent = 'í„°ì¹˜í•˜ì—¬ ë‹¤ì‹œ ì‹œë„';

            history.push({ time: -1, early: true });
            playFail();
        }

        function showResult(time) {
            state = 'result';
            document.body.className = 'result';
            
            history.push({ time: time, early: false });
            
            // ìµœê³  ê¸°ë¡ ê°±ì‹ 
            if (bestTime === 0 || time < bestTime) {
                bestTime = time;
                localStorage.setItem('reactionBest', bestTime);
            }

            // ë“±ê¸‰ ê³„ì‚°
            const grade = getGrade(time);
            
            gameIcon.textContent = grade.emoji;
            gameMessage.textContent = grade.text;
            gameSubMessage.textContent = round < MAX_ROUNDS ? 'í„°ì¹˜í•˜ì—¬ ê³„ì†' : 'í„°ì¹˜í•˜ì—¬ ê²°ê³¼ ë³´ê¸°';
            
            timeDisplay.innerHTML = `${time}<span>ms</span>`;
            timeDisplay.style.display = 'block';
            
            gradeDisplay.textContent = grade.label;
            gradeDisplay.className = 'grade ' + grade.class;
            gradeDisplay.style.display = 'inline-block';
            
            tip.textContent = `${round}/${MAX_ROUNDS} ë¼ìš´ë“œ`;

            playSuccess();
        }

        function getGrade(time) {
            if (time < 200) return { emoji: 'ğŸ†', text: 'ë†€ë¼ì›Œìš”!', label: 'ì´ˆì¸ì ', class: 'excellent' };
            if (time < 250) return { emoji: 'âš¡', text: 'ëŒ€ë‹¨í•´ìš”!', label: 'ë¹ ë¦„', class: 'great' };
            if (time < 300) return { emoji: 'ğŸ‘', text: 'ì¢‹ì•„ìš”!', label: 'ì–‘í˜¸', class: 'good' };
            if (time < 400) return { emoji: 'ğŸ˜Š', text: 'ê´œì°®ì•„ìš”', label: 'í‰ê· ', class: 'average' };
            return { emoji: 'ğŸ¢', text: 'ì¡°ê¸ˆ ëŠë ¤ìš”', label: 'ëŠë¦¼', class: 'slow' };
        }

        function showMenu() {
            state = 'menu';
            document.body.className = 'menu';
            
            gameScreen.style.display = 'none';
            menuScreen.style.display = 'flex';
            tip.textContent = 'í™”ë©´ ì•„ë¬´ ê³³ì´ë‚˜ í„°ì¹˜í•˜ì„¸ìš”';

            // íˆìŠ¤í† ë¦¬ ì €ì¥
            const validTimes = history.filter(h => !h.early).map(h => h.time);
            if (validTimes.length > 0) {
                const savedHistory = JSON.parse(localStorage.getItem('reactionHistory')) || [];
                savedHistory.push(...validTimes);
                // ìµœê·¼ 20ê°œë§Œ ìœ ì§€
                const trimmed = savedHistory.slice(-20);
                localStorage.setItem('reactionHistory', JSON.stringify(trimmed));
            }

            updateStats();
            renderHistory();
        }

        function updateStats() {
            bestTimeEl.textContent = bestTime > 0 ? `${bestTime}ms` : '-';
            
            const savedHistory = JSON.parse(localStorage.getItem('reactionHistory')) || [];
            if (savedHistory.length > 0) {
                const avg = Math.round(savedHistory.reduce((a, b) => a + b, 0) / savedHistory.length);
                avgTimeEl.textContent = `${avg}ms`;
            } else {
                avgTimeEl.textContent = '-';
            }
        }

        function renderHistory() {
            const savedHistory = JSON.parse(localStorage.getItem('reactionHistory')) || [];
            const recent = savedHistory.slice(-10);
            
            historyEl.innerHTML = recent.map(time => {
                let cls = 'slow';
                if (time < 250) cls = 'fast';
                else if (time < 350) cls = 'medium';
                return `<div class="history-item ${cls}">${time}</div>`;
            }).join('');
        }

        renderHistory();

        // í‚¤ë³´ë“œ ì§€ì›
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.code === 'Enter') {
                e.preventDefault();
                if (state === 'menu') {
                    startGame();
                } else {
                    handleGameClick();
                }
            }
        });
    </script>
</body>
</html>
